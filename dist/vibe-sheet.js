!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports.VibeSheet=t(require("react")):e.VibeSheet=t(e.React)}(this,e=>(()=>{"use strict";var t={12:t=>{t.exports=e}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var o=r[e]={exports:{}};return t[e](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};n.r(a),n.d(a,{ActionType:()=>c,Spreadsheet:()=>Re});var o=n(12),l=n.n(o),c=function(e){return e.SET_CELL="SET_CELL",e.BULK_UPDATE="BULK_UPDATE",e.LOAD_DATA="LOAD_DATA",e.SELECT="SELECT",e.FORMAT="FORMAT",e.RESIZE_COL="RESIZE_COL",e.RESIZE_ROW="RESIZE_ROW",e.INSERT_ROW="INSERT_ROW",e.DELETE_ROW="DELETE_ROW",e.INSERT_COL="INSERT_COL",e.DELETE_COL="DELETE_COL",e.UNDO="UNDO",e.NAVIGATE_TAB="NAVIGATE_TAB",e.NAVIGATE_ENTER="NAVIGATE_ENTER",e}({});function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){m(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function m(e,t,r){return(t=function(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d=function(e){for(var t="",r=e;r>=0;)t=String.fromCharCode(65+r%26)+t,r=Math.floor(r/26)-1;return t},f=function(e){var t=e.match(/([A-Z]+)([0-9]+)/);if(!t)return null;for(var r=0,n=0;n<t[1].length;n++)r=26*r+(t[1].charCodeAt(n)-64);return{c:r-1,r:parseInt(t[2])-1}},p=function(e,t){return"".concat(d(e)).concat(t+1)},y=function(e,t){if(!e.startsWith("="))return isNaN(Number(e))?e:Number(e);try{var r=function(e){var r,n,a,o,l=null!==(r=null!==(n=null===(a=t[e])||void 0===a?void 0:a.computed)&&void 0!==n?n:null===(o=t[e])||void 0===o?void 0:o.value)&&void 0!==r?r:0;return isNaN(Number(l))?0:Number(l)},n=e.substring(1).toUpperCase().replace(/\^/g,"**").replace(/(\$?[A-Z]+\$?[0-9]+):(\$?[A-Z]+\$?[0-9]+)/g,function(e,t,n){var a=f(t.replace(/\$/g,"")),o=f(n.replace(/\$/g,""));if(!a||!o)return"[]";for(var l=[],c=Math.min(a.r,o.r);c<=Math.max(a.r,o.r);c++)for(var i=Math.min(a.c,o.c);i<=Math.max(a.c,o.c);i++)l.push(r(p(i,c)));return"[".concat(l.join(","),"]")}).replace(/(\$?[A-Z]+\$?[0-9]+)/g,function(e){return String(r(e.replace(/\$/g,"")))});return new Function("arr","const SUM=a=>a.flat().reduce((x,y)=>x+y,0);const AVERAGE=a=>{const f=a.flat();return f.length?SUM(f)/f.length:0};const MAX=a=>Math.max(...a.flat());const MIN=a=>Math.min(...a.flat());const SIN=Math.sin;const COS=Math.cos;const TAN=Math.tan;const ABS=Math.abs;const SQRT=Math.sqrt;const PI=()=>Math.PI;return ".concat(n))([])}catch(e){return"#ERROR"}},b=function(e){var t={};Object.keys(e).forEach(function(r){t[r]=s({},e[r])});for(var r=0;r<5;r++)Object.keys(t).forEach(function(e){var r=t[e];""===r.value||null===r.value?r.computed="":"string"==typeof r.value&&r.value.startsWith("=")?r.computed=y(r.value,t):r.computed=isNaN(Number(r.value))?r.value:Number(r.value)});return t},v=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a={};return Object.keys(e).forEach(function(o){var l=e[o];if("string"==typeof l.value&&l.value.startsWith("=")){var i=l.value.replace(/(\$?)([A-Z]+)(\$?)([0-9]+)/g,function(e,a,o,l,i){var u=parseInt(i,10)-1,s=f(o+i);if(!s)return e;var m=s.c,p=u,y=m;return t===c.INSERT_ROW&&!l&&u>=r?p+=n:t===c.DELETE_ROW&&!l&&u>r?p-=n:t===c.INSERT_COL&&!a&&m>=r?y+=n:t===c.DELETE_COL&&!a&&m>r&&(y-=n),t===c.DELETE_ROW&&u===r||t===c.DELETE_COL&&m===r?"#REF!":"".concat(a).concat(d(y)).concat(l).concat(p+1)});a[o]=s(s({},l),{},{value:i})}else a[o]=l}),a},h=function(e){var t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",t.style.top="0",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)},E=function(e){var t=0,r=0;return Object.keys(e).forEach(function(e){var n=f(e);n&&(t=Math.max(t,n.c),r=Math.max(r,n.r))}),{maxC:t,maxR:r}},x=function(e){if(!e)return"";var t=e.computed;if(null==t)return"";var r=(e.style||{}).format;return"number"==typeof t?"currency"===r?"$".concat(t.toFixed(2)):"percent"===r?"".concat((100*t).toFixed(1),"%"):t.toString():t.toString()};function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,l,c=[],i=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{if(!i&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(u)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach(function(t){S(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function O(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,L(n.key),n)}}function S(e,t,r){return(t=L(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function L(e){var t=function(e){if("object"!=g(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=g(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==g(t)?t:t+""}var M=function(){return e=function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),S(this,"listeners",new Set),S(this,"debugLog",[]),S(this,"getState",function(){return t.state}),S(this,"getLog",function(){return t.debugLog}),S(this,"subscribe",function(e){return t.listeners.add(e),function(){t.listeners.delete(e)}}),S(this,"replayLog",function(r){var n=(new e).state;t.state=k({},n),t.debugLog=[];var a=new Set(t.listeners);t.listeners.clear();try{r.forEach(function(e){t.dispatch({type:e.type,payload:e.payload})})}catch(e){console.error(e),alert("Invalid log data or format.")}finally{t.listeners=a,t.notify()}}),S(this,"dispatch",function(e){if(t.debugLog.push({time:(new Date).toISOString().split("T")[1].split(".")[0],type:e.type,payload:e.payload}),e.type!==c.UNDO&&e.type!==c.SELECT&&e.type!==c.NAVIGATE_TAB&&e.type!==c.NAVIGATE_ENTER){var r=t.state.history.slice(0,t.state.historyIndex+1);r.push({cells:t.state.cells,rowCount:t.state.rowCount,colCount:t.state.colCount}),t.state.history=r,t.state.historyIndex=r.length}var n=t.state,a=e.payload;switch(e.type){case c.SET_CELL:n.cells=b(k(k({},n.cells),{},S({},a.id,k(k({},n.cells[a.id]),{},{value:a.value}))));break;case c.BULK_UPDATE:var o=k({},n.cells);Object.keys(a.updates).forEach(function(e){null===a.updates[e]?delete o[e]:o[e]=k(k({},o[e]),a.updates[e])}),n.cells=b(o);break;case c.LOAD_DATA:n.cells=b(a);break;case c.SELECT:n.selected={start:a.start,end:a.end||a.start},n.activeCell=p(a.start.c,a.start.r);break;case c.NAVIGATE_TAB:if(n.activeCell&&n.selected.start&&n.selected.end){var l=f(n.activeCell);if(l){var i=Math.min(n.selected.start.c,n.selected.end.c),u=Math.max(n.selected.start.c,n.selected.end.c),s=Math.min(n.selected.start.r,n.selected.end.r),m=Math.max(n.selected.start.r,n.selected.end.r);if(i===u&&s===m){var d=Math.max(0,l.c+(a.shift?-1:1));d>=n.colCount&&(n.colCount=d+1),n.activeCell=p(d,l.r),n.selected={start:{c:d,r:l.r},end:{c:d,r:l.r}}}else{var y=l.c+(a.shift?-1:1),h=l.r;a.shift?y<i&&(y=u,--h<s&&(h=m)):y>u&&(y=i,++h>m&&(h=s)),n.activeCell=p(y,h)}}}break;case c.NAVIGATE_ENTER:if(n.activeCell&&n.selected.start&&n.selected.end){var E=f(n.activeCell);if(E){var x=Math.min(n.selected.start.c,n.selected.end.c),g=Math.max(n.selected.start.c,n.selected.end.c),C=Math.min(n.selected.start.r,n.selected.end.r),N=Math.max(n.selected.start.r,n.selected.end.r);if(x===g&&C===N){var O=E.r+(a.shift?-1:1);O>=n.rowCount&&(n.rowCount=O+3),O=Math.max(0,O),n.activeCell=p(E.c,O),n.selected={start:{c:E.c,r:O},end:{c:E.c,r:O}}}else{var L=E.r+(a.shift?-1:1),M=E.c;a.shift?L<C&&(L=N,--M<x&&(M=g)):L>N&&(L=C,++M>g&&(M=x)),n.activeCell=p(M,L)}}}break;case c.FORMAT:if(n.selected.start&&n.selected.end){for(var T=n.selected,j=T.start,R=T.end,A=Math.min(j.c,R.c),D=Math.max(j.c,R.c),I=Math.min(j.r,R.r),_=Math.max(j.r,R.r),P=k({},n.cells),z=I;z<=_;z++)for(var B=function(){var e,t,r=p(W,z),n=k({},(null===(e=P[r])||void 0===e?void 0:e.style)||{});Object.entries(a.styles).forEach(function(e){var t=w(e,2),r=t[0],a=t[1];void 0===a?delete n[r]:n[r]=a}),P[r]=k(k({},P[r]),{},{value:(null===(t=P[r])||void 0===t?void 0:t.value)||"",style:n})},W=A;W<=D;W++)B();n.cells=P}break;case c.RESIZE_COL:n.colWidths=k(k({},n.colWidths),{},S({},a.index,a.width));break;case c.RESIZE_ROW:n.rowHeights=k(k({},n.rowHeights),{},S({},a.index,a.height));break;case c.INSERT_ROW:var U=v(n.cells,e.type,a.index),H={};Object.keys(U).forEach(function(e){var t=f(e);t&&(t.r>=a.index?H[p(t.c,t.r+1)]=U[e]:H[e]=U[e])}),n.cells=b(H),n.rowCount++;break;case c.DELETE_ROW:var V=v(n.cells,e.type,a.index),F={};Object.keys(V).forEach(function(e){var t=f(e);t&&t.r!==a.index&&(t.r>a.index?F[p(t.c,t.r-1)]=V[e]:F[e]=V[e])}),n.cells=b(F),n.rowCount=Math.max(1,n.rowCount-1);break;case c.INSERT_COL:var Z=v(n.cells,e.type,a.index),K={};Object.keys(Z).forEach(function(e){var t=f(e);t&&(t.c>=a.index?K[p(t.c+1,t.r)]=Z[e]:K[e]=Z[e])}),n.cells=b(K),n.colCount++;break;case c.DELETE_COL:var $=v(n.cells,e.type,a.index),G={};Object.keys($).forEach(function(e){var t=f(e);t&&t.c!==a.index&&(t.c>a.index?G[p(t.c-1,t.r)]=$[e]:G[e]=$[e])}),n.cells=b(G),n.colCount=Math.max(1,n.colCount-1);break;case c.UNDO:if(n.historyIndex>=0){var X=n.history[n.historyIndex];n.cells=X.cells,n.rowCount=X.rowCount,n.colCount=X.colCount,n.historyIndex--}}t.notify()}),this.state={cells:b(r),selected:{start:null,end:null},activeCell:null,colWidths:{},rowHeights:{},rowCount:50,colCount:26,history:[],historyIndex:-1}},(t=[{key:"notify",value:function(){var e=this;this.listeners.forEach(function(t){return t(k({},e.state))})}}])&&O(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),T=(0,o.createContext)(null),j=function(){var e=(0,o.useContext)(T);if(!e)throw new Error("Missing StoreProvider");return e};function R(e){var t=j(),r=w((0,o.useState)(function(){return e(t.getState())}),2),n=r[0],a=r[1];return(0,o.useEffect)(function(){return t.subscribe(function(t){var r=e(t);JSON.stringify(r)!==JSON.stringify(n)&&a(r)})},[t,e,n]),n}var A=function(e){var t=e.size,r=void 0===t?16:t,n=e.className,a=void 0===n?"":n,o=e.children;return l().createElement("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:a},o)},D=function(e){var t=e.icon,r=e.active,n=e.onClick,a=e.label,o=e.children;return l().createElement("button",{onClick:n,title:a,className:"p-1.5 rounded flex items-center gap-1 hover:bg-gray-200 relative ".concat(r?"bg-gray-200 text-blue-600":"text-gray-700")},t&&l().createElement(t,null),o)},I=function(e){var t=e.icon,r=e.color,n=e.onChange,a=e.label;return l().createElement("div",{className:"relative p-1.5 rounded hover:bg-gray-200 cursor-pointer text-gray-700 group",title:a},l().createElement(t,null),l().createElement("div",{className:"h-1 w-full mt-0.5 rounded-sm",style:{backgroundColor:r||"#000"}}),l().createElement("input",{type:"color",className:"absolute inset-0 opacity-0 cursor-pointer w-full h-full",onChange:function(e){return n(e.target.value)},value:r||"#000000"}))},_=function(e){return l().createElement(A,e,l().createElement("path",{d:"M14 12a4 4 0 0 0 0-8H6v8"}),l().createElement("path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z"}))},P=function(e){return l().createElement(A,e,l().createElement("line",{x1:"19",y1:"4",x2:"10",y2:"4"}),l().createElement("line",{x1:"14",y1:"20",x2:"5",y2:"20"}),l().createElement("line",{x1:"15",y1:"4",x2:"9",y2:"20"}))},z=function(e){return l().createElement(A,e,l().createElement("path",{d:"M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"}),l().createElement("line",{x1:"4",y1:"21",x2:"20",y2:"21"}))},B=function(e){return l().createElement(A,e,l().createElement("line",{x1:"17",y1:"10",x2:"3",y2:"10"}),l().createElement("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),l().createElement("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),l().createElement("line",{x1:"17",y1:"18",x2:"3",y2:"18"}))},W=function(e){return l().createElement(A,e,l().createElement("line",{x1:"18",y1:"10",x2:"6",y2:"10"}),l().createElement("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),l().createElement("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),l().createElement("line",{x1:"18",y1:"18",x2:"6",y2:"18"}))},U=function(e){return l().createElement(A,e,l().createElement("line",{x1:"21",y1:"10",x2:"7",y2:"10"}),l().createElement("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),l().createElement("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),l().createElement("line",{x1:"21",y1:"18",x2:"7",y2:"18"}))},H=function(e){return l().createElement(A,e,l().createElement("path",{d:"M3 7v6h6"}),l().createElement("path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"}))},V=function(e){return l().createElement(A,e,l().createElement("rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1"}),l().createElement("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}))},F=function(e){return l().createElement(A,e,l().createElement("rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}),l().createElement("path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}))},Z=function(e){return l().createElement(A,e,l().createElement("circle",{cx:"6",cy:"6",r:"3"}),l().createElement("circle",{cx:"6",cy:"18",r:"3"}),l().createElement("line",{x1:"20",y1:"4",x2:"8.12",y2:"15.88"}),l().createElement("line",{x1:"14.47",y1:"14.48",x2:"20",y2:"20"}),l().createElement("line",{x1:"8.12",y1:"8.12",x2:"12",y2:"12"}))},K=function(e){return l().createElement(A,e,l().createElement("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),l().createElement("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"}))},$=function(e){return l().createElement(A,e,l().createElement("line",{x1:"19",y1:"5",x2:"5",y2:"19"}),l().createElement("circle",{cx:"6.5",cy:"6.5",r:"2.5"}),l().createElement("circle",{cx:"17.5",cy:"17.5",r:"2.5"}))},G=function(e){return l().createElement(A,e,l().createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),l().createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},X=function(e){return l().createElement(A,e,l().createElement("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),l().createElement("polyline",{points:"7 10 12 15 17 10"}),l().createElement("line",{x1:"12",y1:"15",x2:"12",y2:"3"}))},J=function(e){return l().createElement(A,e,l().createElement("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),l().createElement("circle",{cx:"12",cy:"12",r:"3"}))},q=function(e){return l().createElement(A,e,l().createElement("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),l().createElement("polyline",{points:"5 12 12 5 19 12"}))},Y=function(e){return l().createElement(A,e,l().createElement("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),l().createElement("polyline",{points:"19 12 12 19 5 12"}))},Q=function(e){return l().createElement(A,e,l().createElement("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),l().createElement("polyline",{points:"12 19 5 12 12 5"}))},ee=function(e){return l().createElement(A,e,l().createElement("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),l().createElement("polyline",{points:"12 5 19 12 12 19"}))},te=function(e){return l().createElement(A,e,l().createElement("path",{d:"M3 6h18"}),l().createElement("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),l().createElement("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}))},re=function(e){return l().createElement(A,e,l().createElement("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),l().createElement("path",{d:"M3 9h18"}),l().createElement("path",{d:"M3 15h18"}),l().createElement("path",{d:"M9 3v18"}),l().createElement("path",{d:"M15 3v18"}))},ne=function(e){return l().createElement(A,e,l().createElement("circle",{cx:"12",cy:"12",r:"10"}),l().createElement("path",{d:"m4.9 4.9 14.2 14.2"}))},ae=function(e){return l().createElement(A,e,l().createElement("path",{d:"m19 11-8-8-8.6 8.6a2 2 0 0 0 0 2.8l5.2 5.2c.8.8 2 .8 2.8 0L19 11Z"}),l().createElement("path",{d:"m5 2 5 5"}),l().createElement("path",{d:"M2 13h15"}),l().createElement("path",{d:"M22 20a2 2 0 1 1-4 0c0-1.6 1.7-2.4 2-4 .3 1.6 2 2.4 2 4Z"}))},oe=function(e){return l().createElement(A,e,l().createElement("circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor"}),l().createElement("circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor"}),l().createElement("circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor"}),l().createElement("circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor"}),l().createElement("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"}))},le=function(e){return l().createElement(A,e,l().createElement("path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}),l().createElement("path",{d:"M22 21H7"}),l().createElement("path",{d:"m5 11 9 9"}))},ce=function(e){return l().createElement(A,e,l().createElement("path",{d:"M12 3v18"}),l().createElement("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}),l().createElement("path",{d:"M3 9h18"}),l().createElement("path",{d:"M3 15h18"}))},ie=function(e){return l().createElement(A,e,l().createElement("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),l().createElement("polyline",{points:"14 2 14 8 20 8"}),l().createElement("line",{x1:"16",x2:"8",y1:"13",y2:"13"}),l().createElement("line",{x1:"16",x2:"8",y1:"17",y2:"17"}),l().createElement("line",{x1:"10",x2:"8",y1:"9",y2:"9"}))},ue=function(e){return l().createElement(A,e,l().createElement("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),l().createElement("polyline",{points:"14 2 14 8 20 8"}),l().createElement("path",{d:"M8 13h2"}),l().createElement("path",{d:"M8 17h2"}),l().createElement("path",{d:"M14 13h2"}),l().createElement("path",{d:"M14 17h2"}))},se=function(e){return l().createElement(A,e,l().createElement("path",{d:"m8 2 1.88 1.88"}),l().createElement("path",{d:"M14.12 3.88 16 2"}),l().createElement("path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"}),l().createElement("path",{d:"M12 20c-3.3 0-6-2.6-6-5.87V10h12v4.13c0 3.26-2.7 5.87-6 5.87Z"}),l().createElement("path",{d:"M19 19h2"}),l().createElement("path",{d:"M3 19h2"}),l().createElement("path",{d:"M19 13h2"}),l().createElement("path",{d:"M3 13h2"}))},me=function(e){return l().createElement(A,e,l().createElement("polygon",{points:"5 3 19 12 5 21 5 3"}))},de=function(e){var t;switch(e.type){case"left":t=l().createElement(l().Fragment,null,l().createElement("rect",{x:"4",y:"4",width:"16",height:"16",className:"stroke-gray-300"}),l().createElement("line",{x1:"4",y1:"4",x2:"4",y2:"20",className:"stroke-black stroke-2"}));break;case"right":t=l().createElement(l().Fragment,null,l().createElement("rect",{x:"4",y:"4",width:"16",height:"16",className:"stroke-gray-300"}),l().createElement("line",{x1:"20",y1:"4",x2:"20",y2:"20",className:"stroke-black stroke-2"}));break;case"top":t=l().createElement(l().Fragment,null,l().createElement("rect",{x:"4",y:"4",width:"16",height:"16",className:"stroke-gray-300"}),l().createElement("line",{x1:"4",y1:"4",x2:"20",y2:"4",className:"stroke-black stroke-2"}));break;case"bottom":t=l().createElement(l().Fragment,null,l().createElement("rect",{x:"4",y:"4",width:"16",height:"16",className:"stroke-gray-300"}),l().createElement("line",{x1:"4",y1:"20",x2:"20",y2:"20",className:"stroke-black stroke-2"}))}return l().createElement("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4 stroke-current stroke-[1.5px] fill-none"},t)},fe=function(e){for(var t=E(e),r=t.maxC,n=t.maxR,a=[],o=0;o<=n;o++){for(var l=[],c=0;c<=r;c++){var i=e[p(c,o)];l.push(x(i))}a.push(l)}return a},pe=function(e){return e.map(function(e){return e.map(function(e){return e.includes('"')||e.includes(",")?'"'.concat(e.replace(/"/g,'""'),'"'):e}).join(",")}).join("\n")},ye=function(e){var t=e.onExport;return l().createElement("div",{className:"h-11 bg-gray-50 flex items-center px-4 gap-4 border-b border-gray-200 shadow-sm"},l().createElement("div",{className:"flex items-center gap-2 text-gray-700 text-xs font-medium"},l().createElement("span",{className:"uppercase text-gray-400 tracking-wider mr-2"},"Export Data"),l().createElement("button",{onClick:function(){return t("csv")},className:"flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-300 rounded shadow-sm hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 transition-all"},l().createElement(ce,{size:16,className:"text-green-600"})," View as CSV"),l().createElement("button",{onClick:function(){return t("markdown")},className:"flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-300 rounded shadow-sm hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 transition-all"},l().createElement(ie,{size:16,className:"text-blue-600"})," View as Markdown"),l().createElement("button",{onClick:function(){return t("ods")},className:"flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-300 rounded shadow-sm hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 transition-all"},l().createElement(ue,{className:"text-orange-600",size:16})," View as ODS (XML)")))},be=function(e){var t,r=e.visible,n=e.type,a=e.content,o=e.data,c=e.onClose;return r?l().createElement("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-[1px]"},l().createElement("div",{className:"bg-white rounded-lg shadow-2xl border border-gray-300 w-3/4 max-w-2xl flex flex-col max-h-[90%] animate-in fade-in zoom-in-95 duration-200"},l().createElement("div",{className:"flex justify-between items-center p-4 border-b border-gray-200"},l().createElement("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2"},"csv"===n?l().createElement(ce,{size:20,className:"text-green-600"}):"ods"===n?l().createElement(ue,{className:"text-orange-600",size:20}):l().createElement(ie,{size:20,className:"text-blue-600"}),"Export to ",n.toUpperCase()),l().createElement("button",{onClick:c,className:"text-gray-400 hover:text-gray-600"},l().createElement(G,{size:20}))),l().createElement("div",{className:"flex-1 overflow-auto p-4 flex flex-col gap-4"},l().createElement("div",{className:"flex-1 min-h-[150px] flex flex-col"},l().createElement("p",{className:"text-xs font-bold text-gray-500 uppercase mb-1"},"Raw Output"),l().createElement("textarea",{className:"flex-1 w-full border border-gray-300 rounded-md p-3 font-mono text-xs resize-none bg-gray-50 focus:outline-blue-500",readOnly:!0,value:a,onClick:function(e){return e.target.select()}})),l().createElement("div",{className:"flex-1 min-h-[150px] flex flex-col"},l().createElement("p",{className:"text-xs font-bold text-gray-500 uppercase mb-1 flex items-center gap-1"},l().createElement(J,{size:12})," Live Preview"),l().createElement("div",{className:"border border-gray-300 rounded-md overflow-auto bg-white p-1"},l().createElement("table",{className:"w-full text-left border-collapse text-xs"},l().createElement("thead",null,l().createElement("tr",{className:"bg-gray-100 border-b border-gray-300"},null===(t=o[0])||void 0===t?void 0:t.map(function(e,t){return l().createElement("th",{key:t,className:"p-2 font-semibold text-gray-700 border-r last:border-r-0 border-gray-200 whitespace-nowrap"},e)}))),l().createElement("tbody",null,o.slice(1).map(function(e,t){return l().createElement("tr",{key:t,className:"border-b last:border-b-0 border-gray-100 hover:bg-gray-50"},e.map(function(e,t){return l().createElement("td",{key:t,className:"p-2 border-r last:border-r-0 border-gray-200 whitespace-nowrap text-gray-600"},e)}))})))))),l().createElement("div",{className:"p-4 border-t border-gray-200 bg-gray-50 rounded-b-lg flex justify-end gap-2"},l().createElement("button",{onClick:function(){var e="text/plain",t="txt";"csv"===n?(e="text/csv",t="csv"):"markdown"===n?(e="text/markdown",t="md"):"ods"===n&&(e="application/xml",t="fods");var r=new Blob([a],{type:e}),o=URL.createObjectURL(r),l=document.createElement("a");l.href=o,l.download="spreadsheet.".concat(t),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o)},className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 shadow-sm text-sm font-medium flex items-center gap-2"},l().createElement(X,{size:16})," Download File"),l().createElement("button",{onClick:function(){h(a)},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-sm text-sm font-medium flex items-center gap-2"},l().createElement(F,{size:16})," Copy to Clipboard")))):null};function ve(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,l,c=[],i=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{if(!i&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(u)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return he(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?he(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Ee=function(){var e=j(),t=ve((0,o.useState)(!1),2),r=t[0],n=t[1];return l().createElement(l().Fragment,null,l().createElement("div",{className:"h-11 bg-gray-50 flex items-center px-4 gap-4 border-b border-gray-200 shadow-sm"},l().createElement("button",{onClick:function(){var t=e.getLog();h(JSON.stringify(t,null,2)),alert("Debug log copied to clipboard!")},className:"flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-300 rounded shadow-sm hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 transition-all text-xs font-medium text-gray-700"},l().createElement(se,null)," Copy Debug Log"),l().createElement("button",{onClick:function(){return n(!0)},className:"flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-300 rounded shadow-sm hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 transition-all text-xs font-medium text-gray-700"},l().createElement(me,null)," Paste & Replay Log"),l().createElement("span",{className:"text-xs text-gray-400"},"Use these tools to report or reproduce issues.")),l().createElement(xe,{visible:r,onClose:function(){return n(!1)}}))},xe=function(e){var t=e.visible,r=e.onClose,n=j(),a=ve((0,o.useState)(""),2),c=a[0],i=a[1];return t?l().createElement("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-[1px]"},l().createElement("div",{className:"bg-white rounded-lg shadow-2xl border border-gray-300 w-3/4 max-w-lg flex flex-col animate-in fade-in zoom-in-95 duration-200"},l().createElement("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center"},l().createElement("h3",{className:"font-semibold text-gray-800 flex items-center gap-2"},l().createElement(me,null)," Replay Debug Log"),l().createElement("button",{onClick:r},l().createElement(G,null))),l().createElement("div",{className:"p-4 flex-1 flex flex-col gap-2"},l().createElement("p",{className:"text-xs text-gray-500"},"Paste the JSON log below. This will reset the current sheet state and replay all actions."),l().createElement("textarea",{className:"w-full h-64 border border-gray-300 rounded p-2 font-mono text-xs",placeholder:'[{"type": "SELECT", ...}]',value:c,onChange:function(e){return i(e.target.value)}})),l().createElement("div",{className:"p-4 border-t border-gray-200 bg-gray-50 flex justify-end gap-2 rounded-b-lg"},l().createElement("button",{onClick:r,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800"},"Cancel"),l().createElement("button",{onClick:function(){try{var e=JSON.parse(c);Array.isArray(e)?(n.replayLog(e),r(),i("")):alert("Invalid log format (must be array)")}catch(e){alert("Invalid JSON")}},className:"px-4 py-2 bg-blue-600 text-white rounded text-sm font-medium hover:bg-blue-700"},"Replay Log")))):null};function ge(e){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ge(e)}function we(){return we=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},we.apply(null,arguments)}function Ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(r),!0).forEach(function(t){ke(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ce(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ke(e,t,r){return(t=function(e){var t=function(e){if("object"!=ge(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ge(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ge(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Oe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,l,c=[],i=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{if(!i&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(u)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Se(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Se(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Se(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Le=function(e){var t=e.x,r=e.y,n=e.visible,a=e.type,o=e.index,i=e.onCopy,u=e.onCut,s=e.onPaste,m=e.onAction,d=e.onClose;if(!n)return null;var f="fixed z-50 bg-white shadow-xl border border-gray-200 rounded-md py-1 min-w-[180px] text-sm animate-in fade-in zoom-in-95 duration-100";return"row"===a?l().createElement("div",{className:f,style:{top:r,left:t},onClick:function(e){return e.stopPropagation()}},l().createElement("button",{onClick:function(){m(c.INSERT_ROW,o),d()},className:"w-full text-left px-4 py-2 hover:bg-blue-50 flex items-center gap-2 text-gray-700"},l().createElement(q,{size:14})," Insert Row Above"),l().createElement("button",{onClick:function(){m(c.INSERT_ROW,o+1),d()},className:"w-full text-left px-4 py-2 hover:bg-blue-50 flex items-center gap-2 text-gray-700"},l().createElement(Y,{size:14})," Insert Row Below"),l().createElement("div",{className:"h-px bg-gray-100 my-1"}),l().createElement("button",{onClick:function(){m(c.DELETE_ROW,o),d()},className:"w-full text-left px-4 py-2 hover:bg-blue-50 flex items-center gap-2 text-red-600 hover:text-red-700"},l().createElement(te,{size:14})," Delete Row")):"col"===a?l().createElement("div",{className:f,style:{top:r,left:t},onClick:function(e){return e.stopPropagation()}},l().createElement("button",{onClick:function(){m(c.INSERT_COL,o),d()},className:"w-full text-left px-4 py-2 hover:bg-blue-50 flex items-center gap-2 text-gray-700"},l().createElement(Q,{size:14})," Insert Column Left"),l().createElement("button",{onClick:function(){m(c.INSERT_COL,o+1),d()},className:"w-full text-left px-4 py-2 hover:bg-blue-50 flex items-center gap-2 text-gray-700"},l().createElement(ee,{size:14})," Insert Column Right"),l().createElement("div",{className:"h-px bg-gray-100 my-1"}),l().createElement("button",{onClick:function(){m(c.DELETE_COL,o),d()},className:"w-full text-left px-4 py-2 hover:bg-blue-50 flex items-center gap-2 text-red-600 hover:text-red-700"},l().createElement(te,{size:14})," Delete Column")):l().createElement("div",{className:f,style:{top:r,left:t},onClick:function(e){return e.stopPropagation()}},l().createElement("button",{onClick:function(){i(),d()},className:"w-full text-left px-4 py-2 hover:bg-blue-50 flex items-center gap-2 text-gray-700"},l().createElement(F,{size:14})," Copy"),l().createElement("button",{onClick:function(){u(),d()},className:"w-full text-left px-4 py-2 hover:bg-blue-50 flex items-center gap-2 text-gray-700"},l().createElement(Z,{size:14})," Cut"),l().createElement("div",{className:"h-px bg-gray-100 my-1"}),l().createElement("button",{onClick:function(){s(),d()},className:"w-full text-left px-4 py-2 hover:bg-blue-50 flex items-center gap-2 text-gray-700"},l().createElement(V,{size:14})," Paste"))},Me=function(){var e=j(),t=R(function(e){var t;return e.activeCell&&(null===(t=e.cells[e.activeCell])||void 0===t?void 0:t.style)||{}}),r=function(t){return e.dispatch({type:c.FORMAT,payload:{styles:t}})};return l().createElement("div",{className:"h-11 bg-gray-50 flex items-center px-4 gap-4 border-b border-gray-200 shadow-sm overflow-x-auto"},l().createElement("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-3"},l().createElement(D,{icon:H,label:"Undo",onClick:function(){return t=c.UNDO,e.dispatch({type:t});var t}})),l().createElement("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-3"},l().createElement(D,{icon:_,active:t.bold,onClick:function(){return r({bold:!t.bold})},label:"Bold"}),l().createElement(D,{icon:P,active:t.italic,onClick:function(){return r({italic:!t.italic})},label:"Italic"}),l().createElement(D,{icon:z,active:t.underline,onClick:function(){return r({underline:!t.underline})},label:"Underline"})),l().createElement("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-3"},l().createElement(D,{icon:B,active:"left"===t.align,onClick:function(){return r({align:"left"})},label:"Left"}),l().createElement(D,{icon:W,active:"center"===t.align,onClick:function(){return r({align:"center"})},label:"Center"}),l().createElement(D,{icon:U,active:"right"===t.align,onClick:function(){return r({align:"right"})},label:"Right"})),l().createElement("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-3"},l().createElement(D,{icon:K,active:"currency"===t.format,onClick:function(){return r({format:"currency"===t.format?void 0:"currency"})},label:"Currency"}),l().createElement(D,{icon:$,active:"percent"===t.format,onClick:function(){return r({format:"percent"===t.format?void 0:"percent"})},label:"Percent"})),l().createElement("div",{className:"flex items-center gap-1"},l().createElement(D,{onClick:function(){return r({borderTop:!0,borderBottom:!0,borderLeft:!0,borderRight:!0})},label:"All Borders"},l().createElement(re,null)),l().createElement(D,{onClick:function(){return r({borderLeft:!t.borderLeft})},active:t.borderLeft,label:"Left Border"},l().createElement(de,{type:"left"})),l().createElement(D,{onClick:function(){return r({borderTop:!t.borderTop})},active:t.borderTop,label:"Top Border"},l().createElement(de,{type:"top"})),l().createElement(D,{onClick:function(){return r({borderBottom:!t.borderBottom})},active:t.borderBottom,label:"Bottom Border"},l().createElement(de,{type:"bottom"})),l().createElement(D,{onClick:function(){return r({borderRight:!t.borderRight})},active:t.borderRight,label:"Right Border"},l().createElement(de,{type:"right"})),l().createElement(D,{onClick:function(){return r({borderTop:void 0,borderBottom:void 0,borderLeft:void 0,borderRight:void 0})},label:"No Borders"},l().createElement(ne,null)),l().createElement("div",{className:"w-px h-4 bg-gray-300 mx-1"}),l().createElement(I,{icon:ae,color:t.backgroundColor,onChange:function(e){return r({backgroundColor:e})},label:"Fill Color"}),l().createElement(I,{icon:oe,color:t.color,onChange:function(e){return r({color:e})},label:"Text Color"}),l().createElement("div",{className:"w-px h-4 bg-gray-300 mx-1"}),l().createElement(D,{icon:le,onClick:function(){return r({borderTop:void 0,borderBottom:void 0,borderLeft:void 0,borderRight:void 0,backgroundColor:void 0,color:void 0})},label:"Reset Styles"})))},Te=function(){var e=j(),t=R(function(e){return e.activeCell}),r=R(function(e){var t;return e.activeCell&&(null===(t=e.cells[e.activeCell])||void 0===t?void 0:t.value)||""}),n=Oe((0,o.useState)(r),2),a=n[0],i=n[1],u=(0,o.useRef)(null);(0,o.useEffect)(function(){return i(r)},[r]);var s=function(){var r=u.current||t;r&&e.dispatch({type:c.SET_CELL,payload:{id:r,value:a}}),u.current=null};return l().createElement("div",{className:"flex items-center p-1 border-b border-gray-200 bg-white"},l().createElement("div",{className:"w-10 text-center text-gray-500 font-bold border-r border-gray-200 mr-2 text-xs"},t||""),l().createElement("div",{className:"text-gray-400 px-2 font-serif italic text-sm"},"fx"),l().createElement("input",{className:"flex-1 outline-none text-gray-800 text-sm py-0.5",value:a,onChange:function(e){return i(e.target.value)},onFocus:function(){u.current=t},onBlur:s,onKeyDown:function(e){"Enter"===e.key&&s()},placeholder:"Enter value or formula"}))},je=function(){var e=j(),t=R(function(e){return{cells:e.cells,colCount:e.colCount,rowCount:e.rowCount,colWidths:e.colWidths,rowHeights:e.rowHeights,selected:e.selected,activeCell:e.activeCell}}),r=t.cells,n=t.colCount,a=t.rowCount,i=t.colWidths,u=t.rowHeights,s=t.selected,m=t.activeCell,d=Oe((0,o.useState)(!1),2),y=d[0],b=d[1],v=Oe((0,o.useState)(""),2),h=v[0],E=v[1],x=(0,o.useRef)(null),g=(0,o.useRef)(null),w=Oe((0,o.useState)(!1),2),C=w[0],N=w[1],k=(0,o.useRef)(null),O=Oe((0,o.useState)({visible:!1,x:0,y:0,type:"cell",index:-1}),2),S=O[0],L=O[1],M=Oe((0,o.useState)(null),2),T=M[0],A=M[1];(0,o.useEffect)(function(){if(m&&k.current){var e=k.current.querySelector('[data-cell-id="'.concat(m,'"]'));if(e){var t=k.current,r=e.offsetLeft,n=e.offsetTop,a=e.offsetWidth,o=e.offsetHeight,l=t.scrollTop,c=t.scrollLeft,i=t.clientHeight,u=t.clientWidth;r<c+40?t.scrollLeft=r-40:r+a>c+u&&(t.scrollLeft=r+a-u),n<l+24?t.scrollTop=n-24:n+o>l+i&&(t.scrollTop=n+o-i)}}},[m]),(0,o.useEffect)(function(){var e=function(){return L(function(e){return Ne(Ne({},e),{},{visible:!1})})};return window.addEventListener("click",e),function(){window.removeEventListener("click",e)}},[]);var D=function(){if(s.start&&s.end){for(var e=s.start,t=s.end,n=Math.min(e.c,t.c),a=Math.max(e.c,t.c),o=Math.min(e.r,t.r),l=Math.max(e.r,t.r),c={},i=o;i<=l;i++)for(var u=n;u<=a;u++){var m=p(u,i),d=r[m];d&&(c["".concat(u-n,":").concat(i-o)]={value:d.value,style:d.style})}A({width:a-n+1,height:l-o+1,data:c})}},I=function(){if(D(),s.start&&s.end){for(var t=s.start,r=s.end,n=Math.min(t.c,r.c),a=Math.max(t.c,r.c),o=Math.min(t.r,r.r),l=Math.max(t.r,r.r),i={},u=o;u<=l;u++)for(var m=n;m<=a;m++)i[p(m,u)]=null;e.dispatch({type:c.BULK_UPDATE,payload:{updates:i}})}},_=function(){if(T&&m){var t=f(m)||{c:0,r:0},r=t.c,o=t.r,l={};Object.keys(T.data).forEach(function(e){var t=Oe(e.split(":").map(Number),2),c=t[0],i=t[1],u=r+c,s=o+i;u<n&&s<a&&(l[p(u,s)]=T.data[e])}),e.dispatch({type:c.BULK_UPDATE,payload:{updates:l}})}},P=function(e,t,r){e.preventDefault(),L({visible:!0,x:e.clientX,y:e.clientY,type:t,index:r})},z=function(t,r){"col"===t?e.dispatch({type:c.SELECT,payload:{start:{c:r,r:0},end:{c:r,r:a-1}}}):e.dispatch({type:c.SELECT,payload:{start:{c:0,r},end:{c:n-1,r}}})},B=function(e){var t;if(!e)return"";var r=e.computed;if(null==r)return"";var n=null===(t=e.style)||void 0===t?void 0:t.format;return"number"==typeof r?"currency"===n?"$".concat(r.toFixed(2)):"percent"===n?"".concat((100*r).toFixed(1),"%"):r.toString():r.toString()},W=function(){var t=g.current||m;t&&e.dispatch({type:c.SET_CELL,payload:{id:t,value:h}}),b(!1),g.current=null},U=function(){return N(!1)};(0,o.useEffect)(function(){return window.addEventListener("mouseup",U),function(){return window.removeEventListener("mouseup",U)}},[]);var H=null;return s.start&&s.end&&(H={minC:Math.min(s.start.c,s.end.c),maxC:Math.max(s.start.c,s.end.c),minR:Math.min(s.start.r,s.end.r),maxR:Math.max(s.start.r,s.end.r)}),l().createElement("div",{ref:k,className:"flex-1 overflow-auto relative focus:outline-none",tabIndex:0,onKeyDown:function(t){if("Tab"!==t.key){var r;if("Enter"===t.key)return t.preventDefault(),y&&W(),e.dispatch({type:c.NAVIGATE_ENTER,payload:{shift:t.shiftKey}}),void(null===(r=k.current)||void 0===r||r.focus());if(!y&&1===t.key.length&&!t.ctrlKey&&!t.metaKey)return t.preventDefault(),g.current=m,b(!0),E(t.key),void setTimeout(function(){var e;return null===(e=x.current)||void 0===e?void 0:e.focus()},0);if("Backspace"!==t.key&&"Delete"!==t.key||m&&e.dispatch({type:c.SET_CELL,payload:{id:m,value:""}}),s.start){var o=t.shiftKey&&s.end?s.end:s.start,l=o.c,i=o.r;if(!t.shiftKey&&m){var u=f(m);u&&(l=u.c,i=u.r)}"ArrowUp"===t.key&&(i=Math.max(0,i-1)),"ArrowDown"===t.key&&(i=Math.min(a-1,i+1)),"ArrowLeft"===t.key&&(l=Math.max(0,l-1)),"ArrowRight"===t.key&&(l=Math.min(n-1,l+1)),l===o.c&&i===o.r||(t.preventDefault(),t.shiftKey?e.dispatch({type:c.SELECT,payload:{start:s.start,end:{c:l,r:i}}}):e.dispatch({type:c.SELECT,payload:{start:{c:l,r:i}}}))}(t.ctrlKey||t.metaKey)&&("z"===t.key&&(t.preventDefault(),e.dispatch({type:c.UNDO})),"c"===t.key&&(t.preventDefault(),D()),"x"===t.key&&(t.preventDefault(),I()),"v"===t.key&&(t.preventDefault(),_()))}else{var d;t.preventDefault(),y&&(W(),null===(d=k.current)||void 0===d||d.focus()),e.dispatch({type:c.NAVIGATE_TAB,payload:{shift:t.shiftKey}})}}},l().createElement(Le,we({},S,{onCopy:D,onCut:I,onPaste:_,onAction:function(t,r){e.dispatch({type:t,payload:{index:r}})},onClose:function(){return L(function(e){return Ne(Ne({},e),{},{visible:!1})})}})),l().createElement("div",{className:"inline-block min-w-full"},l().createElement("table",{className:"border-collapse w-full table-fixed"},l().createElement("thead",null,l().createElement("tr",null,l().createElement("th",{className:"w-10 bg-gray-100 border border-gray-300 sticky top-0 left-0 z-30"}),Array.from({length:n}).map(function(t,n){return l().createElement("th",{key:n,className:"border border-gray-300 text-gray-600 font-medium h-6 min-w-[80px] sticky top-0 z-20 resize-x overflow-hidden text-xs hover:bg-gray-200 cursor-pointer\n                                        ".concat(H&&n>=H.minC&&n<=H.maxC?"bg-blue-100 text-blue-700":"bg-gray-100"),style:{width:i[n]||80},onClick:function(){return z("col",n)},onContextMenu:function(e){return P(e,"col",n)}},l().createElement("div",{className:"flex justify-center items-center w-full h-full relative group"},p(n,0).replace(/[0-9]/g,""),l().createElement("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-400",onMouseDown:function(t){t.stopPropagation();var r=t.pageX,a=i[n]||80,o=function(t){var o=Math.max(40,a+(t.pageX-r));e.dispatch({type:c.RESIZE_COL,payload:{index:n,width:o}})},l=function(){document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",l)},onDoubleClick:function(t){t.stopPropagation();var o=function(e){for(var t=10,n=function(e){return 5*e.length+10},o=0;o<a;o++){var l=p(e,o),c=r[l];if(c&&void 0!==c.computed&&null!==c.computed){var i=B(c);t=Math.max(t,n(i))}}return t}(n);e.dispatch({type:c.RESIZE_COL,payload:{index:n,width:o}})}})))}))),l().createElement("tbody",null,Array.from({length:a}).map(function(t,a){return l().createElement("tr",{key:a,style:{height:u[a]||24}},l().createElement("td",{className:"border border-gray-300 text-center text-gray-500 font-medium sticky left-0 z-20 text-xs relative group hover:bg-gray-200 cursor-pointer\n                                        ".concat(H&&a>=H.minR&&a<=H.maxR?"bg-blue-100 text-blue-700":"bg-gray-100"),onClick:function(){return z("row",a)},onContextMenu:function(e){return P(e,"row",a)}},l().createElement("div",{className:"flex justify-center items-center h-full pointer-events-none"},a+1),l().createElement("div",{className:"absolute bottom-0 left-0 right-0 h-1 cursor-row-resize hover:bg-blue-400 z-30",onMouseDown:function(t){t.stopPropagation();var r=t.pageY,n=u[a]||24,o=function(t){var o=Math.max(24,n+(t.pageY-r));e.dispatch({type:c.RESIZE_ROW,payload:{index:a,height:o}})},l=function(){document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",l)}})),Array.from({length:n}).map(function(t,n){var o=p(n,a),i=r[o],u=m===o,d=H&&n>=H.minC&&n<=H.maxC&&a>=H.minR&&a<=H.maxR,f=(null==i?void 0:i.style)||{};return l().createElement("td",{key:n,"data-cell-id":o,className:"border border-gray-200 px-1 overflow-hidden whitespace-nowrap text-ellipsis cursor-cell relative ".concat(u?"outline outline-2 outline-blue-500 z-10":""),style:{fontWeight:f.bold?"bold":"normal",fontStyle:f.italic?"italic":"normal",textDecoration:f.underline?"underline":"none",textAlign:f.align||"left",backgroundColor:f.backgroundColor,color:f.color,borderTop:f.borderTop?"1px solid #000":void 0,borderBottom:f.borderBottom?"1px solid #000":void 0,borderLeft:f.borderLeft?"1px solid #000":void 0,borderRight:f.borderRight?"1px solid #000":void 0},onMouseDown:function(t){return function(t,r,n){if(!(2===n.button||y&&h.trim().startsWith("="))){y&&W(),N(!0);var a={c:t,r};n.shiftKey&&s.start?e.dispatch({type:c.SELECT,payload:{start:s.start,end:a}}):e.dispatch({type:c.SELECT,payload:{start:a}})}}(n,a,t)},onMouseEnter:function(){return function(t,r){C&&s.start&&e.dispatch({type:c.SELECT,payload:{start:s.start,end:{c:t,r}}})}(n,a)},onContextMenu:function(t){return function(t,r,n){var a,o,l,i,u,m,d,f;t.preventDefault(),s.start&&r>=Math.min(s.start.c,null!==(a=null===(o=s.end)||void 0===o?void 0:o.c)&&void 0!==a?a:-1)&&r<=Math.max(s.start.c,null!==(l=null===(i=s.end)||void 0===i?void 0:i.c)&&void 0!==l?l:-1)&&n>=Math.min(s.start.r,null!==(u=null===(m=s.end)||void 0===m?void 0:m.r)&&void 0!==u?u:-1)&&n<=Math.max(s.start.r,null!==(d=null===(f=s.end)||void 0===f?void 0:f.r)&&void 0!==d?d:-1)||e.dispatch({type:c.SELECT,payload:{start:{c:r,r:n}}}),L({visible:!0,x:t.clientX,y:t.clientY,type:"cell",index:-1})}(t,n,a)},onClick:function(){return function(e,t){var r;y&&h.trim().startsWith("=")&&(E(function(r){return r+p(e,t)}),null===(r=x.current)||void 0===r||r.focus())}(n,a)},onDoubleClick:function(){return function(e,t){var n,a=p(e,t);g.current=a,E((null===(n=r[a])||void 0===n?void 0:n.value)||""),b(!0),setTimeout(function(){var e;return null===(e=x.current)||void 0===e?void 0:e.focus()},0)}(n,a)}},d&&!u&&l().createElement("div",{className:"absolute inset-0 bg-blue-500/20 pointer-events-none"}),u&&y?l().createElement("input",{ref:x,className:"w-full h-full outline-none bg-transparent relative z-20",value:h,onChange:function(e){return E(e.target.value)},style:{color:f.color}}):l().createElement("span",{className:"pointer-events-none block w-full overflow-hidden text-ellipsis relative z-10"},B(i)))}))})))))},Re=(0,o.forwardRef)(function(e,t){e.id;var r=e.initialData,n=void 0===r?{}:r,a=(0,o.useMemo)(function(){return new M(n)},[]),i=Oe((0,o.useState)("Home"),2),u=i[0],s=i[1],m=Oe((0,o.useState)({visible:!1,type:"csv",content:"",data:[]}),2),d=m[0],f=m[1];return(0,o.useImperativeHandle)(t,function(){return{ToCSV:function(){var e=fe(a.getState().cells);return pe(e)},LoadCSV:function(e){var t=function(e){for(var t={},r=[],n=[],a="",o=!1,l=0;l<e.length;l++){var c=e[l],i=e[l+1];'"'===c?o&&'"'===i?(a+='"',l++):o=!o:","!==c||o?"\r"!==c&&"\n"!==c||o?a+=c:(n.push(a),a="",r.push(n),n=[],"\r"===c&&"\n"===i&&l++):(n.push(a),a="")}return(a||n.length>0)&&n.push(a),n.length>0&&r.push(n),r.forEach(function(e,r){e.forEach(function(e,n){void 0!==e&&""!==e&&(t[p(n,r)]={value:e})})}),t}(e);a.dispatch({type:c.LOAD_DATA,payload:t})},SetCell:function(e,t){a.dispatch({type:c.SET_CELL,payload:{id:e,value:t}})}}}),l().createElement(T.Provider,{value:a},l().createElement("div",{className:"flex flex-col h-full bg-white overflow-hidden text-sm font-sans select-none relative"},l().createElement("div",{className:"bg-gray-100 border-b border-gray-300 px-2 pt-2 gap-1 flex"},l().createElement("button",{onClick:function(){return s("Home")},className:"px-4 py-1.5 text-sm font-medium rounded-t-lg border-t border-x border-transparent relative top-[1px] z-10 ".concat("Home"===u?"bg-gray-50 text-blue-700 border-gray-200":"text-gray-600 hover:bg-gray-100")},"Home"),l().createElement("button",{onClick:function(){return s("Data")},className:"px-4 py-1.5 text-sm font-medium rounded-t-lg border-t border-x border-transparent relative top-[1px] z-10 ".concat("Data"===u?"bg-gray-50 text-blue-700 border-gray-200":"text-gray-600 hover:bg-gray-100")},"Data"),l().createElement("button",{onClick:function(){return s("Help")},className:"px-4 py-1.5 text-sm font-medium rounded-t-lg border-t border-x border-transparent relative top-[1px] z-10 ".concat("Help"===u?"bg-gray-50 text-blue-700 border-gray-200":"text-gray-600 hover:bg-gray-100")},"Help")),"Home"===u&&l().createElement(Me,null),"Data"===u&&l().createElement(ye,{onExport:function(e){var t=a.getState().cells,r=fe(t),n="";"csv"===e?n=pe(r):"markdown"===e?n=function(e){if(0===e.length)return"";var t=e[0],r="| "+t.map(function(e){return e||" "}).join(" | ")+" |\n";r+="| "+t.map(function(){return"---"}).join(" | ")+" |\n";for(var n=1;n<e.length;n++)r+="| "+e[n].map(function(e){return e||" "}).join(" | ")+" |\n";return r}(r):"ods"===e&&(n=function(e){for(var t=E(e),r=t.maxC,n=t.maxR,a=new Map,o=1,l="",c=function(e){if(!e||0===Object.keys(e).length)return null;var t=JSON.stringify(e,Object.keys(e).sort());if(a.has(t))return a.get(t);var r="ce".concat(o++);a.set(t,r);var n="";e.bold&&(n+=' fo:font-weight="bold"'),e.italic&&(n+=' fo:font-style="italic"'),e.underline&&(n+=' style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="font-color"'),e.color&&(n+=' fo:color="'.concat(e.color,'"'));var c="";e.backgroundColor&&(c+=' fo:background-color="'.concat(e.backgroundColor,'"'));var i="0.06pt solid #000000";e.borderTop&&(c+=' fo:border-top="'.concat(i,'"')),e.borderBottom&&(c+=' fo:border-bottom="'.concat(i,'"')),e.borderLeft&&(c+=' fo:border-left="'.concat(i,'"')),e.borderRight&&(c+=' fo:border-right="'.concat(i,'"'));var u="";return e.align&&(u+=' fo:text-align="'.concat({left:"start",center:"center",right:"end"}[e.align]||"start",'"')),l+='\n    <style:style style:name="'.concat(r,'" style:family="table-cell" style:parent-style-name="Default">\n      <style:table-cell-properties').concat(c,"/>\n      <style:text-properties").concat(n,"/>\n      <style:paragraph-properties").concat(u,"/>\n    </style:style>"),r},i="",u=0;u<=n;u++){i+="\n    <table:table-row>";for(var s=0;s<=r;s++){var m=e[p(s,u)],d=null==m?void 0:m.computed,f=null==m?void 0:m.value,y=null==m?void 0:m.style,b="";if(y){var v=c(y);v&&(b+=' table:style-name="'.concat(v,'"'))}if("string"==typeof f&&f.startsWith("=")){var h=f.replace(/(\S?[A-Z]+\S?[0-9]+)/g,function(e){return e.includes("$")?"[".concat(e,"]"):"[.".concat(e,"]")});h=h.replace(/,/g,";"),b+=' table:formula="of:'.concat(h,'"')}var x="";if(null==d||""===d);else if("number"==typeof d)b+=' office:value-type="float" office:value="'.concat(d,'"'),x="<text:p>".concat(d,"</text:p>");else{b+=' office:value-type="string"';var g=String(d).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");x="<text:p>".concat(g,"</text:p>")}i+="\n     <table:table-cell".concat(b,">").concat(x,"</table:table-cell>")}i+="\n    </table:table-row>"}return'<?xml version="1.0" encoding="UTF-8"?>\n<office:document xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0"\n  xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0"\n  xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0"\n  xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0"\n  xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0"\n  xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0"\n  xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0"\n  xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0"\n  xmlns:xsd="http://www.w3.org/2001/XMLSchema"\n  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n  xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2"\n  office:version="1.3"\n  office:mimetype="application/vnd.oasis.opendocument.spreadsheet">\n <office:automatic-styles>\n  '.concat(l,'\n </office:automatic-styles>\n <office:body>\n  <office:spreadsheet>\n   <table:table table:name="Sheet1">\n    ').concat(i,"\n   </table:table>\n  </office:spreadsheet>\n </office:body>\n</office:document>")}(t)),f({visible:!0,type:e,content:n,data:r})}}),"Help"===u&&l().createElement(Ee,null),l().createElement(Te,null),l().createElement(je,null),l().createElement(be,we({},d,{onClose:function(){return f(function(e){return Ne(Ne({},e),{},{visible:!1})})}}))))});return a})());